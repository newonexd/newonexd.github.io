<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.jpg">
  <link rel="icon" type="image/png" href="/img/icon.jpg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="学习区块链技术ing...">
  <meta name="author" content="任晓东">
  <meta name="keywords" content="blockchain fabric">
  <title>blog/couchDB/CouchDB学习一 ~ 触不可及的官方网站</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.10.2/css/all.min.css"  >
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css"  >
<link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.8.9/css/mdb.min.css"  >
<link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"  >


</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>触不可及的官方网站</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">主页</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/1.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期五, 十二月 20日 2019, 7:58 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    4k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      16 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h2 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h2><table>
<thead>
<tr>
<th>端口号</th>
<th>协议</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>5984</td>
<td>tcp</td>
<td>标椎集群端口用于所有的HTTP API请求</td>
</tr>
<tr>
<td>5986</td>
<td>tcp</td>
<td>用于管理员对节点与分片的管理</td>
</tr>
<tr>
<td>4369</td>
<td>tcp</td>
<td>Erlang端口到daemon的映射</td>
</tr>
</tbody></table>
<h3 id="配置介绍"><a href="#配置介绍" class="headerlink" title="配置介绍"></a>配置介绍</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>CouchDb从以下位置按顺序读取配置文件</p>
<ul>
<li>etc/fefault.ini</li>
<li>etc/default.d/*.ini</li>
<li>etc/local.ini</li>
<li>etc/local.d/*.ini</li>
</ul>
<p>类UNIX系统：<code>/opt/couchdb/</code><br>Windows系统:<code>C:\CouchDB</code><br>maxOS:<code>Applications/Apache CouchDB.app/Contents/Resources/couchdbx-core/etc</code>下的<code>default.ini</code>和<code>default.d</code>文件夹。<code>/Users/youruser/Library/Application Support/CouchDB2/etc/couchdb</code>下的<code>default.ini</code>和<code>default.d</code>文件夹.</p>
<h4 id="通过HTTP-API修改参数"><a href="#通过HTTP-API修改参数" class="headerlink" title="通过HTTP API修改参数"></a>通过HTTP API修改参数</h4><p><strong>集群</strong>：</p>
<pre><code>curl -X PUT http://localhost:5984/_node/name@host/_config/uuids/algorithm -d &#39;&quot;random&quot;&#39;</code></pre><p><strong>单节点</strong></p>
<pre><code>curl -X PUT http://localhost:5984/_node/_local/_config/uuids/algorithm -d &#39;&quot;random&quot;&#39;</code></pre><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><h4 id="couchdb配置"><a href="#couchdb配置" class="headerlink" title="couchdb配置"></a>couchdb配置</h4><p><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/couchdb/</code>后接参数.</p>
<ul>
<li>attachment_stream-buffer_size<br>  缓冲池大小，越大读性能越好，但增加写操作的响应时间.</li>
<li>database_dir<br>  数据库文件地址</li>
<li>default_security<br>  默认的安全级别<code>admin_local</code>. <code>everyone</code>:任何人都可以读和写。<code>admin_only</code>：只有admin可以读和写.<code>admin_local</code>:被分片的数据库可以被任何人读和写，但分片只可以被admin读和写.</li>
<li>delayed_commits<br>  延迟提交 <code>false</code>保证同步.<code>true</code>可以提高性能。</li>
<li>file_compression<br>  文件压缩默认<code>snappy</code>。<code>none</code>：不进行压缩。<code>snappy</code>：使用谷歌的snappy.<code>deflate_N</code>：使用<code>zlib</code>,N为压缩等级从1(速度最快，压缩率最低)到9(速度最慢，压缩率最高).</li>
<li>fsync_options<br>  缓冲区内的文件是否与操作系统同步刷新到硬盘中.一般不需要修改.<code>fsync_options=[before_header,after_header,on_file_open]</code></li>
<li>max_dbs_open<br>  同时打开数据库的最大数量默认为100.</li>
<li>os_process_timeout<br>  处理超时时间默认5000ms</li>
<li>uri_file<br>  该参数指定的文件包含完整的用来访问CouchDB数据库实例的<code>URI</code>.默认值：<code>/var/run/couchdb/couchdb.uri</code></li>
<li>users_db_suffix<br>  用户数据库后缀，默认<code>_users</code>.</li>
<li>util_driver_dir<br>  二进制驱动的位置。</li>
<li>uuid<br>  CouchDb服务器实例的唯一标识符</li>
<li>view_index_dir<br>  CouchDB视图索引文件的位置。默认值:<code>/var/lib/couchdb</code></li>
<li>maintenance_mode<br>  CouchDb节点可以使用的两种维护模式 <code>true</code>:该节点不会响应集群中其他节点的请求并且<code>/_up</code>端点将返回404响应.<code>nolb</code>:<code>/_up</code>端点将返回404响应.<code>false</code>:该节点正常响应200。</li>
<li>max_document_size<br>  文档的最大的大小默认为4GB</li>
</ul>
<h3 id="cluster-配置"><a href="#cluster-配置" class="headerlink" title="cluster 配置"></a>cluster 配置</h3><h4 id="集群选项"><a href="#集群选项" class="headerlink" title="集群选项"></a>集群选项</h4><p><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/cluster/</code>后接参数.</p>
<ul>
<li>q<br>  新创建的数据库的分片数量，默认为8</li>
<li>n<br>  集群中每一个数据库文档的副本数。单节点为1，每个节点最多仅持有一个副本。</li>
<li>placement</li>
<li>seedlist<br>  以逗号分隔的节点名称列表，当前节点应与之通信加入集群。</li>
</ul>
<h3 id="couch-peruser"><a href="#couch-peruser" class="headerlink" title="couch_peruser"></a>couch_peruser</h3><h4 id="couch-peruser配置"><a href="#couch-peruser配置" class="headerlink" title="couch_peruser配置"></a>couch_peruser配置</h4><p><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/couch_peruser/</code>后接参数.</p>
<ul>
<li><p>enable<br>  如果设置为true，则_users为私有的数据库。且只允许当前节点操作。</p>
</li>
<li><p>delete_dbs<br>  如果设置为true，当用户被删除，则相关的数据库也一同删除。</p>
<h3 id="CouchDB-HTTP-服务器"><a href="#CouchDB-HTTP-服务器" class="headerlink" title="CouchDB HTTP 服务器"></a>CouchDB HTTP 服务器</h3><h4 id="HTTP-Server配置"><a href="#HTTP-Server配置" class="headerlink" title="HTTP Server配置"></a>HTTP Server配置</h4></li>
<li><p>*[chttpd]**<br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/chttpd/</code>后接参数.</p>
</li>
<li><p>bind_address :集群端口绑定的IP地址</p>
<ul>
<li>127.0.0.1</li>
<li>0.0.0.0：任何IP地址</li>
<li>::1:IPV6</li>
<li>:: 任何IPV6的地址</li>
</ul>
</li>
<li><p>port:集群端口号</p>
<ul>
<li>5984:默认</li>
<li>0：可使用任何端口号</li>
</ul>
</li>
<li><p>prefer_minimal:如果一个请求含有请求头:Prefer,则只返回<code>prefer_minimal</code>配置列表的头部信息</p>
</li>
<li><p>authentication_handlers:CouchDB使用的认证头部信息。可以使用第三方插件进行扩展。</p>
<ul>
<li>{chttpd_auth, cookie_authentication_handler}: Cookie认证;</li>
<li>{couch_httpd_auth, proxy_authentication_handler}:代理认证;</li>
<li>{chttpd_auth, default_authentication_handler}: 基本认证：</li>
<li>{couch_httpd_auth, null_authentication_handler}:取消认证</li>
</ul>
</li>
</ul>
<p><strong>[httpd]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/httpd/</code>后接参数.<br>在CouchDB2.X版本，这一部分默认使用5986为默认端口。用于管理员任务与系统维护。应该总是绑定私有的LAN 127.0.0.1地址。</p>
<ul>
<li><p>allow_jsonp</p>
<ul>
<li>是否支持JSONP，默认false    </li>
</ul>
</li>
<li><p>bind_address</p>
<ul>
<li>本地节点可获得的IP地址。建议总是使用127.0.0.1或IPV6 ::1</li>
</ul>
</li>
<li><p>changes_timeout</p>
<ul>
<li>默认超时时间默认为6000ms</li>
</ul>
</li>
<li><p>config_whitelist</p>
<ul>
<li>配置信息修改白名单。只有白名单内的值可以通过CONFIG API修改配置。为了允许管理员通过HTTP修改该值，需要包括{httpd,config——whitelist}自己。</li>
<li>config_whitelist = [{httpd,config_whitelist}, {log,level}, {etc,etc}]</li>
</ul>
</li>
<li><p>default_handler</p>
<ul>
<li>具体的默认HTTP请求Handler</li>
<li>default_handler = {couch_httpd_db, handle_request}</li>
</ul>
</li>
<li><p>enable_cors</p>
<ul>
<li>控制CORS特性,默认false</li>
</ul>
</li>
<li><p>port</p>
<ul>
<li>定义监听的端口号 默认5986</li>
</ul>
</li>
<li><p>redirect_vhost_handler</p>
<ul>
<li>Handler请求到<code>virtual hosts</code>的定制的默认功能</li>
<li>redirect_vhost_handler = {Module, Fun}</li>
</ul>
</li>
<li><p>server_options</p>
<ul>
<li>可以被添加到配置文件的<code>MochiWeb</code>组件的服务器选项。</li>
<li>server_options = [{backlog, 128}, {acceptor_pool_size, 16}]</li>
</ul>
</li>
<li><p>secure_rewrites</p>
<ul>
<li>是否允许通过子域隔离数据库。</li>
</ul>
</li>
<li><p>socket_options</p>
<ul>
<li>CouchDB监听Socket选项。可以定义为元组列表.</li>
<li>socket_options = [{sndbuf, 262144}, {nodelay, true}]</li>
</ul>
</li>
<li><p>server_options</p>
<ul>
<li>CouchDB中mochiweb acceptor池中任何socket服务器选项，可以定义为元组列表.</li>
<li>server_options = [{recbuf, undefined}]</li>
</ul>
</li>
<li><p>vhost_global_handlers</p>
<ul>
<li>对于<code>virtual hosts</code>全局的Handlers列表</li>
<li>vhost_global_handlers = _utils, _uuids, _session, _users</li>
</ul>
</li>
<li><p>x_forwarded_host</p>
<ul>
<li>用于转发<code>HOST</code>头部字段的原始值。例如一个转发代理在请求Couchd前重写<code>Host</code>头部信息到内部主机。</li>
<li>x_forwarded_host = X-Forwarded-Host</li>
</ul>
</li>
<li><p>x_forwarded_proto</p>
<ul>
<li>认证原始的HTTP协议</li>
</ul>
</li>
<li><p>x_forwarded_ssl</p>
<ul>
<li>用于告诉CouchDB使用https代替http</li>
</ul>
</li>
<li><p>enable_xframe_options</p>
<ul>
<li>控制是否开启特性</li>
</ul>
</li>
<li><p>WWW-Authenticate</p>
<ul>
<li>设置在基本认证下不具备权限的请求头部信息</li>
</ul>
</li>
<li><p>max_http_request_size</p>
<ul>
<li>限制HTTP请求体最大值大小默认4GB</li>
</ul>
</li>
</ul>
<h4 id="HTTPS-SSL-TLS-选项"><a href="#HTTPS-SSL-TLS-选项" class="headerlink" title="HTTPS (SSL/TLS)选项"></a>HTTPS (SSL/TLS)选项</h4><p>CouchDb支持本地TLS/SSL，不需要使用代理服务器.HTTPS设置比较容器，只需要两个文件：一个证书个一个私钥。可以通过<code>OpenSSL</code>命令生成自签名证书。</p>
<pre><code>shell&gt; mkdir /etc/couchdb/cert
shell&gt; cd /etc/couchdb/cert
shell&gt; openssl genrsa &gt; privkey.pem
shell&gt; openssl req -new -x509 -key privkey.pem -out couchdb.pem -days 1095
shell&gt; chmod 600 privkey.pem couchdb.pem
shell&gt; chown couchdb privkey.pem couchdb.pem</code></pre><p>编辑CouchDB配置文件<code>local.ini</code>：</p>
<pre><code>enable = true
cert_file = /etc/couchdb/cert/couchdb.pem
key_file = /etc/couchdb/cert/privkey.pem</code></pre><p>使用自签名证书可以通过参数<code>-k</code>忽略警告信息</p>
<pre><code>curl -k https://127.0.0.1:6984</code></pre><p><strong>[ssl]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/ssl/</code>后接参数.</p>
<ul>
<li>cacert_file<ul>
<li>包含PEM编码的CA证书路径,CA证书用于构建服务器证书链。用于客户端权限认证。</li>
</ul>
</li>
<li>cert_file<ul>
<li>包含用户证书文件的路径</li>
</ul>
</li>
<li>key_file<ul>
<li>包含用户PEM编码的私钥文件路径</li>
</ul>
</li>
<li>password<ul>
<li>包含用户密码的字符串,当用户私钥通过密码保护时使用</li>
</ul>
</li>
<li>ssl_certifacate_max_depth<ul>
<li>最大的节点证书深度</li>
</ul>
</li>
<li>verify_fun<ul>
<li>如果不指定具体的验证功能，则使用默认的验证功能</li>
</ul>
</li>
<li>verify_ssl_certificates<ul>
<li>如果为true则验证节点证书</li>
</ul>
</li>
<li>fail_if_no_peer_cert<ul>
<li>true：如果客户端没有发送证书，则终止TLS/SSL握手</li>
<li>false：只当客户端发送无效证书时，终止TLS/SSL握手</li>
</ul>
</li>
<li>secure_renegotiate</li>
<li>ciphers<ul>
<li>设置erlang格式的被支持的加密套件</li>
<li>ciphers = [“ECDHE-ECDSA-AES128-SHA256”, “ECDHE-ECDSA-AES128-SHA”]</li>
</ul>
</li>
<li>tls_versions<ul>
<li>设置允许的SSL/TLS协议版本列表</li>
<li>tls_versions = [tlsv1 | ‘tlsv1.1’ | ‘tlsv1.2’]</li>
</ul>
</li>
</ul>
<h4 id="跨域资源分享"><a href="#跨域资源分享" class="headerlink" title="跨域资源分享"></a>跨域资源分享</h4><p>跨域资源分享.比如浏览器中运行js的网页通过AJAX请求到不同的域。不需要破坏任何一方的安全。<br>一个典型的用例是通过静态网页通过CDN请求另一资源。比如CouchDB实例。这避免了使用JSONP或类似的变通方法来检索和托管内容的中间代理。<br>CouchDB实例可以接受直接的连接保护数据库和实例。不会造成浏览器功能由于相同的域的限制被阻塞。CORS支持当前90%的浏览器。<br><strong>[cors]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/httpd/</code>后接参数.</p>
<ul>
<li><p>enable_cors<br>需要将<code>httpd/enable_cors</code>选项设置为<code>true</code>。<br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/cors/</code>后接参数.</p>
</li>
<li><p>credentials</p>
<ul>
<li>默认情况下，请求和响应中均不包含身份验证标头或cookie。</li>
</ul>
</li>
<li><p>origins</p>
<ul>
<li>通过，分隔接受的原始的URL列表。不能同时设置origins=*和credentials=true</li>
</ul>
</li>
<li><p>headers</p>
<ul>
<li>通过，分隔的可接受的请求头列表。</li>
</ul>
</li>
<li><p>methods</p>
<ul>
<li>可接受的请求方法</li>
</ul>
</li>
<li><p>max_age</p>
<ul>
<li>Access-Control-Max-Age</li>
</ul>
</li>
</ul>
<h4 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h4><p>虚拟主机<br>CouchDB可以基于<code>Host</code>请求头映射请求到绑定同一个IP地址的不同的位置。<br>允许同一机器上不同虚拟机映射到不同的数据库或者是设计文档。<br>通过为域名添加一个<code>CNAME</code>指针到DNS。在测试或者开发环境下，添加一个实体到hosts文件,如类UNIX系统：</p>
<pre><code>127.0.0.1       couchdb.local</code></pre><p>最后添加一个实体到配置文件的<code>[vhosts]</code>部分：</p>
<pre><code>couchdb.local:5984 = /example
*.couchdb.local:5984 = /example</code></pre><p>如果CouchDB监听在默认的HTTP端口80，或者之前设置了代理，则不需要在<code>vhosts</code>中指定端口号.<br>第一行将重写请求以显示示例数据库的内容。 仅当Host标头为couchdb.local且不适用于CNAME时，此规则才有效，另一方面，第二条规则将所有CNAME与示例db匹配，这样<a href="http://www.couchdb.local和db.couchdb.local都可以使用。" target="_blank" rel="noopener">www.couchdb.local和db.couchdb.local都可以使用。</a><br><strong>[vhosts]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/vhosts/</code>后接参数.</p>
<ul>
<li><p>couchdb.local</p>
<h3 id="认证与权限"><a href="#认证与权限" class="headerlink" title="认证与权限"></a>认证与权限</h3><h4 id="服务器管理员"><a href="#服务器管理员" class="headerlink" title="服务器管理员"></a>服务器管理员</h4><p>默认的CouchDB提供了管理员级别的可以访问所有连接的用户。配置在<code>Admin Party</code>部分。不应该在生产环境中使用。可以在创建第一个管理员账户后删除这一部分。CouchDB服务管理员和密码没有存储在<code>_users</code>数据库。但是CouchDB加载ini文件时可以在最后发现<code>admin</code>部分。这个文件(可能为<code>etc/local.ini</code>或者<code>etc/local.d/10-admins.ini</code>在Debian/Ubuntu系统从包中安装时发现。)应该安全并且只能由系统管理员可读.<br>管理员可以直接添加到<code>admin</code>部分，当CouchDB重新启动时，密码将会自动加密。也可以通过HTTP接口创建管理员账户不需要重启CouchDB。HTTP<code>/_node/{node-name}/_config/admins</code>地址支持查询，删除或者是创建新管理员账户。</p>
</li>
<li><p>*[admins]**<br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/admins/</code>后接参数.</p>
<h4 id="认证配置"><a href="#认证配置" class="headerlink" title="认证配置"></a>认证配置</h4></li>
<li><p>*[chttpd]**<br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/chttpd/</code>后接参数.</p>
</li>
<li><p>require_valid_user</p>
<ul>
<li>true:不允许来自匿名用户的任何请求</li>
</ul>
</li>
</ul>
<p><strong>[couch_httpd_auth]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/couch_httpd_auth/</code>后接参数.</p>
<ul>
<li>allow_persistent_cookies<ul>
<li>使得Cookie持久性。</li>
</ul>
</li>
<li>cookie_domain<ul>
<li>配置<code>AuthSession</code>Cookie的域属性。默认为空。</li>
<li>cookie_domain=example.com</li>
</ul>
</li>
<li>auth_cache_size<ul>
<li>内容中用户对象缓存数量，减少硬盘读写，默认50</li>
</ul>
</li>
<li>authentication_redirect<ul>
<li>权限成功验证后，客户端接受<code>text/html</code>响应情况下具体的重定向的位置。</li>
<li>authentication_redirect = /_utils/session.html</li>
</ul>
</li>
</ul>
<ul>
<li>iterations<ul>
<li>由PBKDF2算法哈希的密码迭代的数量。</li>
</ul>
</li>
<li>min_iterations<ul>
<li>最小迭代的数量</li>
</ul>
</li>
<li>max_iterations<ul>
<li>最大迭代的数量</li>
</ul>
</li>
<li>proxy_use_secret<ul>
<li>true:<code>couch_httpd_auth/secret</code>选项要求代理身份认证</li>
</ul>
</li>
<li>public_fields<ul>
<li>用户文档中可以被任何用户读的由逗号分隔的字段名称。</li>
<li>public_fields = first_name, last_name, contacts, url</li>
</ul>
</li>
<li>require_valid_user<ul>
<li>true:不允许来自匿名用户的任何请求</li>
</ul>
</li>
<li>secret<ul>
<li>用于代理身份认证与Cookie身份认证的secret</li>
</ul>
</li>
<li>timeout<ul>
<li>最后一次请求之后session超时过期时间默认600</li>
</ul>
</li>
<li>users_db_public<ul>
<li>允许用户查看所有用户文档，默认情况下，只有管理员可以查看所有用户的文档,用户只能查看自己的文档。</li>
</ul>
</li>
<li>x_auth_roles<ul>
<li>HTTP请求头包含用户的角色，用逗号分隔。用于代理身份认证</li>
</ul>
</li>
<li>x_auth_token<ul>
<li>HTTP请求头包含用户的token，用逗号分隔。用于代理身份认证</li>
</ul>
</li>
<li>x_auth_username<ul>
<li>HTTP请求头包含用户的用户名，用逗号分隔。用于代理身份认证</li>
</ul>
</li>
</ul>
<h3 id="压缩配置"><a href="#压缩配置" class="headerlink" title="压缩配置"></a>压缩配置</h3><h4 id="数据库压缩配置"><a href="#数据库压缩配置" class="headerlink" title="数据库压缩配置"></a>数据库压缩配置</h4><p><strong>[database_compaction]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/database_compaction/</code>后接参数.</p>
<ul>
<li>doc_buffer_size<ul>
<li>具体的拷贝缓冲区大小</li>
</ul>
</li>
<li>checkpoint_after<ul>
<li>在具体数量的比特后激活检查点拷贝到压缩数据库。</li>
</ul>
</li>
</ul>
<h4 id="压缩程序规则"><a href="#压缩程序规则" class="headerlink" title="压缩程序规则"></a>压缩程序规则</h4><p><strong>[compactions]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/compactions/</code>后接参数.<br>列表中的规则确定什么时候运行自动压缩。配置可以是指定数据库或者是全局的。格式如下:</p>
<pre><code>database_name = [ {ParamName, ParamValue}, {ParamName, ParamValue}, ... ]
_default = [ {ParamName, ParamValue}, {ParamName, ParamValue}, ... ]
_default = [{db_fragmentation, &quot;70%&quot;}, {view_fragmentation, &quot;60%&quot;}, {from,&quot;23:00&quot;}, {to, &quot;04:00&quot;}]</code></pre><ol>
<li>db_fragmentation:数据库中数据压缩率，包括元数据。计算方法：(file_size-data_size)/file_size*100</li>
<li>view_fragmentation：数据库中索引文件…..</li>
<li>form,to:允许进行压缩的时间段,格式：<code>HH:MM - HH:MM  (HH in [0..23], MM in [0..59])</code></li>
<li>strict_window:如果为true，并且在超时时间后还没有压缩完则终止压缩。</li>
<li>parallel_view_compaction：是否数据和视图同时进行压缩。</li>
</ol>
<h4 id="压缩程序配置"><a href="#压缩程序配置" class="headerlink" title="压缩程序配置"></a>压缩程序配置</h4><p><strong>[compaction_daemon]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/compaction_daemon/</code>后接参数.</p>
<ul>
<li>check_interval<ul>
<li>两次检查数据库和视图索引是否需要被压缩的时间间隔，默认为3600</li>
</ul>
</li>
<li>min_file_size<ul>
<li>如果数据库或者视图索引文件大小小于该值，则不进行压缩。</li>
</ul>
</li>
<li>snooze_period_ms</li>
</ul>
<h4 id="视图压缩选项"><a href="#视图压缩选项" class="headerlink" title="视图压缩选项"></a>视图压缩选项</h4><p><strong>[view_compaction]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/view_compaction/</code>后接参数.</p>
<ul>
<li>keyvalue_buffer_size<ul>
<li>压缩时具体的最大拷贝缓冲区大小.</li>
</ul>
</li>
</ul>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><h4 id="日志选项"><a href="#日志选项" class="headerlink" title="日志选项"></a>日志选项</h4><p><strong>[log]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/log/</code>后接参数.</p>
<ul>
<li>writer<ul>
<li>stderr：日志信息发送到stderr(默认)</li>
<li>file:日志信息存储到文件</li>
<li>syslog：日志信息发送到syslog daemon</li>
</ul>
</li>
<li>file<ul>
<li>日志保存到文件的具体的位置(默认<code>/var/log/couchdb/couch.log</code>)</li>
</ul>
</li>
<li>write_buffer<ul>
<li>写日志缓冲区大小默认0</li>
</ul>
</li>
<li>write_delay<ul>
<li>写日志到硬盘延迟默认为0</li>
</ul>
</li>
<li>level<ul>
<li>日志级别</li>
<li>debug</li>
<li>info：包括HTTP请求，启动外部程序</li>
<li>notice</li>
<li>warning,warn：警告信息，例如硬盘空间不足</li>
<li>error,err：只输出错误信息</li>
<li>critical crit</li>
<li>alert</li>
<li>emergency emerg</li>
<li>none:不输入任何日志</li>
</ul>
</li>
<li>include_sasl<ul>
<li>是否在日志中包含SASL信息</li>
</ul>
</li>
<li>syslog_host<ul>
<li>具体的syslog 主机将日志发送到的位置默认localhost</li>
</ul>
</li>
<li>syslog_port<ul>
<li>当发送日志信息时连接的syslog端口</li>
</ul>
</li>
<li>syslog_appid<ul>
<li>具体的应用名称默认couchdb</li>
</ul>
</li>
<li>syslog_facility</li>
</ul>
<h3 id="复制者"><a href="#复制者" class="headerlink" title="复制者"></a>复制者</h3><h4 id="数据库复制配置"><a href="#数据库复制配置" class="headerlink" title="数据库复制配置"></a>数据库复制配置</h4><p><strong>[replicator]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/replicator/</code>后接参数.</p>
<ul>
<li>max_jobs<ul>
<li>活跃的运行的复制任务数量。</li>
</ul>
</li>
<li>interval</li>
<li>max_churn</li>
<li>update_docs</li>
<li>worker_batch_size</li>
<li>worker_processes</li>
<li>http_connections</li>
<li>connection_timeout</li>
<li>retries_per_request</li>
<li>socket_options</li>
<li>checkpoint_interval</li>
<li>use_checkpoints</li>
<li>cert_file</li>
<li>key_file</li>
<li>password</li>
<li>verify_ssl_certificates</li>
<li>ssl_trusted_certificates_file</li>
<li>ssl_certificate_max_depth</li>
<li>auth_plugins</li>
</ul>
<h3 id="Query-Servers"><a href="#Query-Servers" class="headerlink" title="Query Servers"></a>Query Servers</h3><h4 id="Query-Servers-Definition"><a href="#Query-Servers-Definition" class="headerlink" title="Query Servers Definition"></a>Query Servers Definition</h4><p><strong>[query_servers]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/query_servers/</code>后接参数.</p>
<h4 id="Query-Servers-Configuration"><a href="#Query-Servers-Configuration" class="headerlink" title="Query Servers Configuration"></a>Query Servers Configuration</h4><p><strong>[query_sercver_config]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/query_sercver_config/</code>后接参数.</p>
<ul>
<li>commit_freq</li>
<li>os_process_limit</li>
<li>os_process_soft_limit</li>
<li>reduce_limit</li>
</ul>
<h4 id="Native-Erlang-Query-Server"><a href="#Native-Erlang-Query-Server" class="headerlink" title="Native Erlang Query Server"></a>Native Erlang Query Server</h4><p><strong>[native_query_servers]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/native_query_servers/</code>后接参数.</p>
<h3 id="CouchDB-Internal-Services"><a href="#CouchDB-Internal-Services" class="headerlink" title="CouchDB Internal Services"></a>CouchDB Internal Services</h3><h4 id="CouchDB-Daemonized-Mini-Apps"><a href="#CouchDB-Daemonized-Mini-Apps" class="headerlink" title="CouchDB Daemonized Mini Apps"></a>CouchDB Daemonized Mini Apps</h4><p><strong>[daemons]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/daemons/</code>后接参数.</p>
<ul>
<li>auth_cache</li>
<li>compaction_daemon</li>
<li>external_manager</li>
<li>httpd</li>
<li>index_server</li>
<li>query_servers</li>
<li>replicator_manager</li>
<li>stats_aggregator</li>
<li>stats_collector</li>
<li>uuids</li>
<li>vhosts</li>
</ul>
<h3 id="Miscellaneous-Parameters"><a href="#Miscellaneous-Parameters" class="headerlink" title="Miscellaneous Parameters"></a>Miscellaneous Parameters</h3><h4 id="Configuration-of-Attachment-Storage"><a href="#Configuration-of-Attachment-Storage" class="headerlink" title="Configuration of Attachment Storage"></a>Configuration of Attachment Storage</h4><p><strong>[attachments]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/attachments/</code>后接参数.</p>
<ul>
<li>compression_level</li>
<li>compressible_types</li>
</ul>
<h4 id="Statistic-Calculation"><a href="#Statistic-Calculation" class="headerlink" title="Statistic Calculation"></a>Statistic Calculation</h4><p><strong>[stats]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/stats/</code>后接参数.</p>
<ul>
<li>rate</li>
<li>samples</li>
</ul>
<h4 id="UUIDs-Configuration"><a href="#UUIDs-Configuration" class="headerlink" title="UUIDs Configuration"></a>UUIDs Configuration</h4><p><strong>[uuids]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/uuids/</code>后接参数.</p>
<ul>
<li>algorithm</li>
<li>utc_id_suffix</li>
<li>max_count</li>
</ul>
<h4 id="Vendor-information"><a href="#Vendor-information" class="headerlink" title="Vendor information"></a>Vendor information</h4><p><strong>[vendor]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/vendor/</code>后接参数.</p>
<h4 id="Content-Security-Policy"><a href="#Content-Security-Policy" class="headerlink" title="Content-Security_Policy"></a>Content-Security_Policy</h4><p><strong>[csp]</strong><br><code>curl</code>地址：<code>http://localhost:5984/_node/&lt;name@host&gt;/_config/csp/</code>后接参数.</p>
<ul>
<li>enable</li>
<li>header_value</li>
</ul>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><h3 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h3><h4 id="查看所有节点"><a href="#查看所有节点" class="headerlink" title="查看所有节点"></a>查看所有节点</h4><pre><code>curl -u admin:adminpw -X GET http://localhost:5984/_membership
{
    &quot;all_nodes&quot;:[   # 当前节点所知道的节点
        &quot;node1@xxx.xxx.xxx.xxx&quot;],
    &quot;cluster_nodes&quot;:[ #当前节点所连接的节点
        &quot;node1@xxx.xxx.xxx.xxx&quot;],
}</code></pre><h4 id="添加一个节点"><a href="#添加一个节点" class="headerlink" title="添加一个节点"></a>添加一个节点</h4><pre><code>curl -u admin:adminpw -X PUT http://localhost:5986/_nodes/node2@yyy.yyy.yyy.yyy -d {}</code></pre><h4 id="删除一个节点"><a href="#删除一个节点" class="headerlink" title="删除一个节点"></a>删除一个节点</h4><pre><code>#首先获取关于文档的revision
curl -u admin:adminpw -X GET &quot;http://xxx.xxx.xxx.xxx:5986/_nodes/node2@yyy.yyy.yyy.yyy&quot;
{&quot;_id&quot;:&quot;node2@yyy.yyy.yyy.yyy&quot;,&quot;_rev&quot;:&quot;1-967a00dff5e02add41820138abb3284d&quot;}    
#删除节点
curl -u admin:adminpw -X DELETE http://localhost:5986/_nodes/node2@yyy.yyy.yyy.yyy?rev=1-967a00dff5e02add41820138abb3284d</code></pre><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p>数据库名字不支持大写字符，只支持[a-z],[0-9],以及特殊字符:<code>_ $ ( ) + - /</code></p>
<pre><code>#创建一个数据库名字为db_name 
curl -u admin:adminpw -X PUT http://localhost:5984/db_name?q=4&amp;n=2</code></pre><h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><pre><code>curl -u admin:adminpw -X DELETE http://localhost:5984/db_name</code></pre>
            <hr>
          </div>
          <br>
          <div>
            <p>
            
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.11.1/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '61f05c79f7a13c277323',
      clientSecret: '3564592f28eec1ac00931de44f215d4c0ed0939b',
      repo: 'newonexd.github.io',
      owner: 'newonexd',
      admin: 'newonexd',
      id: md5(location.pathname),
      language: 'zh-CN',
      perPage: 15,
      pagerDirection: 'last',
      createIssueManually: 'true',
      distractionFreeMode: 'false'
    });

    gitalk.render('gitalk-container')
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js" ></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js" ></script>
<script src="https://cdn.staticfile.org/mdbootstrap/4.8.9/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="https://cdn.staticfile.org/tocbot/4.8.0/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="https://cdn.staticfile.org/smooth-scroll/16.1.0/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  




  <script src="https://cdn.staticfile.org/prettify/r298/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  ');
      prettyPrint();
    })
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.10/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "blog/couchDB/CouchDB学习一&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.0/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
